/*
  ArtboardJS v0.0.0
  (c) 2017 Depth Development. http://depthdev.com
  License: MIT
*/
var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};!function(e,t){"use strict";e.Artboard=function(){function i(e){e.preventDefault(),e.stopPropagation(),S=0,b=0;for(var t=m;t;)S+=t.offsetTop,b+=t.offsetLeft,t=t.offsetParent}function n(e){P=[],C=[];for(var t=0,i=e.length;t<i;t++)P.push(e[t].pageX-b),C.push(e[t].pageY-S)}function o(e){A.isPlaying||(e.preventDefault(),e.stopPropagation(),i(e),n(e.touches),A.createEntry(),D(),A.rewrite())}function r(e){e.preventDefault(),e.stopPropagation(),n(e.touches),D()}function l(e){A.isPlaying||(e.preventDefault(),e.stopPropagation(),_=!0,i(e),P=[e.pageX-b],C=[e.pageY-S],A.createEntry(),D(),A.rewrite())}function a(e){_&&(e.preventDefault(),e.stopPropagation(),P=[e.pageX-b],C=[e.pageY-S],D())}function u(e){_&&(_=!1,e.preventDefault(),e.stopPropagation())}function h(i){if(!A.isPlaying){var n=i||{};m.width=n.width||t.documentElement.clientWidth,m.height=n.height||e.innerHeight,B.clearRect(0,0,m.width,m.height),p=n.multiTouch!==!1,y=n.rainbow!==!1,B.fillStyle=n.color||"#000000",B.shadowColor=B.fillStyle,B.shadowBlur=n.glow>=0?n.glow:10,T=0,E=n.radius>=0?n.radius:10,A.timeline=[]}}function s(e){if(!A.isPlaying){var t={multiTouch:p,rainbow:y,color:B.fillStyle,glow:B.shadowBlur,degree:T,radius:E},i=e||{};m.width=i.width||m.width,m.height=i.height||m.height,B.clearRect(0,0,m.width,m.height),A.timeline=[],p=t.multiTouch,y=t.rainbow,B.fillStyle=t.color,B.shadowColor=B.fillStyle,B.shadowBlur=t.glow,T=t.degree,E=t.radius}}function d(){A.isPlaying||(B.clearRect(0,0,m.width,m.height),A.timeline=[])}function c(e){if(!A.isPlaying){var t=e||{};p=void 0!==t.multiTouch?t.multiTouch:p,y=void 0!==t.rainbow?t.rainbow:y,B.fillStyle=t.color||B.fillStyle,B.shadowColor=B.fillStyle,B.shadowBlur=t.glow>=0?t.glow:B.shadowBlur,E=t.radius>=0?t.radius:E}}function g(){this.a=t.createElement("a"),this.a.href=m.toDataURL("image/png"),this.a.download="ArtboardJS",this.a.click(),delete this.a}function f(){A.timeline=[],m.removeEventListener("touchstart",o),m.removeEventListener("touchmove",r),m.removeEventListener("mousedown",l),m.removeEventListener("mousemove",a),t.removeEventListener("mouseup",u)}var m=arguments[0],w="object"===_typeof(arguments[1])&&arguments[1];if(!m.getContext){var v=arguments[arguments.length-1];return"function"==typeof v&&v(),!1}var p=!0,y=!0,S=0,b=0,P=[],C=[],E=10,L=2*Math.PI,T=0,B=m.getContext("2d");B.fillStyle="#000000",B.shadowColor="#000000",B.shadowOffsetX=0,B.shadowOffsetY=0,B.shadowBlur=10;var D=null,_=!1,A={timeline:[],createEntry:function(){A.timeline.push([])},undoCount:0,save:function(){localStorage.artboard=JSON.stringify({width:m.width,height:m.height,timeline:A.timeline})},saveAs:function(e,t){return/^[a-zA-Z0-9_$]+$/.test(e)?(localStorage["artboard_"+e]=JSON.stringify({width:m.width,height:m.height,timeline:A.timeline}),!t||t(!0)):!!t&&t(!1)},saved:function(){var e=[];for(var t in localStorage)/^artboard_/.test(t)&&e.push(t.replace(/^artboard_/,""));return e},backup:function(){return{width:m.width,height:m.height,timeline:A.timeline}},restore:function(e,t){if(!e||e instanceof Event){if(localStorage.artboard){var i=JSON.parse(localStorage.artboard);return m.width=i.width,m.height=i.height,A.timeline=i.timeline,A.undoCount=0,A.change(),!t||t(!0)}return!!t&&t(!1)}if("string"==typeof e){if(localStorage["artboard_"+e]){var n=JSON.parse(localStorage["artboard_"+e]);return m.width=n.width,m.height=n.height,A.timeline=n.timeline,A.undoCount=0,A.change(),!t||t(!0)}return!!t&&t(!1)}try{return m.width=e.width,m.height=e.height,A.timeline=e.timeline,A.undoCount=0,A.change(),!t||t(!0)}catch(o){return!!t&&t(!1)}},deleteSaved:function(){for(var e in localStorage)/^artboard_/.test(e)&&delete localStorage[e]},rewrite:function(){A.undoCount&&(A.timeline.splice(A.timeline.length-1-A.undoCount,A.undoCount),A.undoCount=0)},log:function(){A.timeline[A.timeline.length-1].push({multiTouch:p,rainbow:y,color:B.fillStyle,x:P,y:C,radius:E,degree:T,glow:B.shadowBlur})},currentStateForDev:function(){return{multiTouch:p,rainbow:y,color:B.fillStyle,x:P,y:C,radius:E,degree:T,glow:B.shadowBlur}},change:function(){B.clearRect(0,0,m.width,m.height);for(var e=0,t=0,i=A.timeline.length-A.undoCount,n=A.timeline[e].length;e<i;e++)for(t=0,n=A.timeline[e].length;t<n;t++)p=A.timeline[e][t].multiTouch,y=A.timeline[e][t].rainbow,B.fillStyle=A.timeline[e][t].color,P=A.timeline[e][t].x,C=A.timeline[e][t].y,E=A.timeline[e][t].radius,T=A.timeline[e][t].degree,B.shadowBlur=A.timeline[e][t].glow,B.shadowColor=B.fillStyle,D(!0)},undo:function(){return A.undoCount!==A.timeline.length&&(A.undoCount++,A.change()),A.currentStateForDev()},redo:function(){return A.undoCount>0&&(A.undoCount--,A.change()),A.currentStateForDev()},stopPlaying:!1,isPlaying:!1,play:function(){function t(){return p=A.timeline[i][n].multiTouch,y=A.timeline[i][n].rainbow,B.fillStyle=A.timeline[i][n].color,P=A.timeline[i][n].x,C=A.timeline[i][n].y,E=A.timeline[i][n].radius,T=A.timeline[i][n].degree,B.shadowBlur=A.timeline[i][n].glow,B.shadowColor=B.fillStyle,D(!0),n++,A.stopPlaying?void(A.stopPlaying=!1):void(n===r?i+1!==o?(i++,n=0,r=A.timeline[i].length,e.requestAnimationFrame(t)):(A.stopPlaying=!1,A.isPlaying=!1):e.requestAnimationFrame(t))}if(A.timeline.length){A.isPlaying=!0,B.clearRect(0,0,m.width,m.height);var i=0,n=0,o=A.timeline.length,r=A.timeline[i].length;t()}},stop:function(){A.stopPlaying=!0,e.setTimeout(function(){A.isPlaying=!1,A.stopPlaying=!1,A.change()},100)}};return D=function(e){y&&(B.fillStyle="hsl("+T+",100%,50%)",B.shadowColor="hsl("+T+",100%,50%)",T++);for(var t=0,i=P.length;t<i&&(B.beginPath(),B.arc(P[t],C[t],E,0,L,!1),B.fill(),p);t++);e||A.log()},m.addEventListener("touchstart",o),m.addEventListener("touchmove",r),m.addEventListener("mousedown",l),m.addEventListener("mousemove",a),t.addEventListener("mouseup",u),h(w),{adjust:c,backup:A.backup,clear:d,deleteSaved:A.deleteSaved,destroy:f,hardReset:h,image:g,play:A.play,redo:A.redo,reset:s,restore:A.restore,save:A.save,saveAs:A.saveAs,saved:A.saved,stop:A.stop,undo:A.undo}}}(window,document);